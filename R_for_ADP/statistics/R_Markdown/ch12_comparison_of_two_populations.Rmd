---
title: "12장 두 모집단의 비교"
author: "Taeyoon Kim"
date: "2024-11-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<br/>

### 12.2 두 개의 독립 표본 

<br/>

#### 12.2.2 한자능력검정시험에서의 점수를 근거로 하여 도시 A, B 의 학생들을 비교하였다. 중학교 1학년의 A 도시 학생 90명과 B 도시 학생 100명의 표본으로부터 구한 대회 점수에 대한 통계량 값이 자료와 같다. 두 도시 간의 모평균 점수의 차에 대한 98% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_2_02.csv", row.names = 1)

x_bar = data['평균', 'A']
y_bar = data['평균', 'B']
s_1 = data['표준편차', 'A']
s_2 = data['표준편차', 'B']
n_1 = data['표본크기', 'A']
n_2 = data['표본크기', 'B']

lowerbound = (x_bar - y_bar) + qnorm(p=0.01) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qnorm(p=0.99) * sqrt(s_1^2/n_1 + s_2^2/n_2)
answer = paste("(", lowerbound, ",", upperbound, ")")

cat(answer)
```

<br/>

#### 12.2.4 두 개의 처리를 비교하기 위한 실험에 141개의 실험재료를 사용하였다. 79개의 실험재료를 임의로 추출하여 처리 1을 행하고 나머지 62개의 실험재료에 대하여 처리 2를 행하였다. 두 처리에 대한 반응의 평균과 표준편차는 자료와 같다. 처리효과의 평균의 차에 대한 98% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_2_04.csv", row.names = 1)

x_bar = data['평균', '처리1']
y_bar = data['평균', '처리2']
s_1 = data['표준편차', '처리1']
s_2 = data['표준편차', '처리2']
n_1 = 79
n_2 = 62

lowerbound = (x_bar - y_bar) + qnorm(p=0.01) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qnorm(p=0.99) * sqrt(s_1^2/n_1 + s_2^2/n_2)
answer = paste("(", lowerbound, ",", upperbound, ")")

cat(answer)

```

<br/>

#### 12.2.6 어린이 성장과 사회환경에 관한 연구의 한 분야로서 부모가 고등교육을 받지 못한 1학년생(집단1)과 부모가 대학교육을 받은 1학년생(집단2)의 언어능력의 비교에 대한 연구가 이루어졌다. 집단1과 집단2로부터 각각 66명, 38명의 어린이를 임의로 뽑아서 그들의 언어능력을 점수로 계산한 통계량이 자료와 같다,

##### (1) 두 집단 간 언어능력의 차이가 있는가? (유의수준 $\alpha=0.01$로 검정하라.)

##### (2) 두 어린이 집단의 모평균 점수차에 대한 98% 신뢰구간을 계산하라.

```{r}
data = read.csv("../Data/exercise_12_2_06.csv", row.names = 1)

x_bar = data['평균', '집단1']
y_bar = data['평균', '집단2']
s_1 = data['표준편차', '집단1']
s_2 = data['표준편차', '집단2']
n_1 = 66
n_2 = 38
alpha = 0.01

z = ((x_bar - y_bar) - 0) / sqrt(s_1^2/n_1 + s_2^2/n_2)

if ((z < qnorm(alpha/2)) | (z > qnorm(1 - alpha/2))) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

if (z < 0) {
  p_value = pnorm(q=z)
} else {
  p_value = 1 - pnorm(q=z)
}

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message
)

lowerbound = (x_bar - y_bar) + qnorm(0.01) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qnorm(0.99) * sqrt(s_1^2/n_1 + s_2^2/n_2)

answer_2 = paste("(", lowerbound, ",", upperbound, ")")

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.2.8 국내 고용평등추진위원회는 여성 고용인에 대한 임금이 같은 처지의 남성 고용인의 임금만큼 지급되는지에 대한 조사를 실시하였다. 하급사원에서 남성 75명, 여성 64명을 임의로 뽑아서 그들의 임금 자료로부터 자료와 같은 값을 얻었다.

##### (1) 남녀 하급사원의 평균임금의 차에 대한 95% 신뢰구간을 구하라. 

##### (2) **(1)**에서 구한 신뢰구간을 참조하여 평균임금이 같다는 귀무가설에 대하여 남성의 임금이 더 높다고 할 수 있는지 검정하고자 한다. 유의수준 $\alpha=0.05$로 가설검정에 대한 결론을 내려라.

```{r}
data = read.csv("../Data/exercise_12_2_07.csv", row.names = 1)

x_bar = data['평균', '남성']
y_bar = data['평균', '여성']
s_1 = data['표준편차', '남성']
s_2 = data['표준편차', '여성']
n_1 = 75
n_2 = 64
alpha = 0.05

lowerbound = (x_bar - y_bar) + qnorm(alpha/2) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qnorm(1-alpha/2) * sqrt(s_1^2/n_1 + s_2^2/n_2)

answer_1 = paste("(", lowerbound, ",", upperbound, ")")

z = ((x_bar - y_bar) - 0) / sqrt(s_1^2/n_1 + s_2^2/n_2)

if ((z > qnorm(1-alpha))) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pnorm(q=z)

answer_2 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message
)

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.2.10 섬세함을 요구하는 어느 작업에서 성별에 따라 작업하는 데 걸리는 시간이 차이가 있는지 판단하고자 48명의 남성을 대상으로 작업시간을 조사한 결과 평균 7.92분, 표준편차 3.45분이고, 38명 여성의 작업시간은 평균 5.80분, 표준편차 2.87분이었다. 여성보다 남성이 작업하는 데 시간이 오래 걸린다고 할 수 있는지 검정하라. (P-값을 이용하여 답하라.)

```{r}
x_bar = 7.92
y_bar = 5.80
s_1 = 3.45
s_2 = 2.87
n_1 = 48
n_2 = 38
alpha = 0.05

z = ((x_bar - y_bar) - 0) / sqrt(s_1^2/n_1 + s_2^2/n_2)

if ((z > qnorm(1-alpha))) {  # 주의! 여성보다 남성이 오래 걸리는 거다!
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pnorm(q=z)

answer = paste(
  " 검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n", message
)

cat(answer)
```

<br/>

#### 12.2.12 두 개의 모집단에서 얻은 서로 독립인 표본에 대한 통계량이 자료와 같이 주어졌다. 필요한 가정이 있으면 기술하고 다음에 답하라.

##### (1) $(\mu_1 - \mu_2)$에 대한 95% 신뢰구간을 구하라.

##### (2) 가설 $H_0: \mu_1 - \mu_2 = 10$ 대 $H_0: \mu_1 - \mu_2 > 10$에 대한 검정을 하라. ($\alpha=0.01$)


```{r}
data = read.csv("../Data/exercise_12_2_12.csv", row.names = 1)

x_bar = data['mean', '표본1']
y_bar = data['mean', '표본2']
s_1 = data['sd', '표본1']
s_2 = data['sd', '표본2']
n_1 = data['n', '표본1']
n_2 = data['n', '표본2']
s_p = sqrt(((n_1 - 1) * s_1^2 + (n_2 - 1) * s_2^2) / (n_1 + n_2 - 2))
alpha = 0.01

lowerbound = (x_bar-y_bar) + qt(0.05/2, df=n_1 + n_2 -2) * s_p * sqrt(1/n_1 + 1/n_2)
upperbound = (x_bar-y_bar) + qt(1-0.05/2, df=n_1 + n_2 -2) * s_p * sqrt(1/n_1 + 1/n_2)

answer_1 = paste("(", lowerbound, ",", upperbound, ")")

t = ((x_bar - y_bar) - 10) / (s_p * sqrt(1/n_1 + 1/n_2))

if (t > qt(1-alpha, df = n_1 + n_2 - 2)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pt(q=t, df = n_1 + n_2 - 2)

answer_2 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message
)

cat("가정: 두 모집단이 정규분포를 따르고 두 모표준편차가 같다고 하자.", "\n(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.2.14 두 모집단으로부터 서로 독립인 표본들에 대하여 자료와 같은 통계량이 주어졌다. 필요한 가정이 있으면 기술하고 다음에 답하라.

##### (1) $(\mu_1 - \mu_2)$에 대한 98% 신뢰구간을 구하라.

##### (2) 가설 $H_0: \mu_1 - \mu_2 = 20$ 대 $H_0: \mu_1 - \mu_2 < 20$에 대한 검정을 하라. ($\alpha=0.025$)

```{r}
data = read.csv("../Data/exercise_12_2_14.csv", row.names = 1)

x_bar = data['mean', '표본1']
y_bar = data['mean', '표본2']
s_1 = data['sd', '표본1']
s_2 = data['sd', '표본2']
n_1 = data['n', '표본1']
n_2 = data['n', '표본2']

if ((s_1 / s_2 < 1/2) | (s_1 / s_2 > 2)) {
  assumption = "가정: 두 모집단이 정규분포를 따르지만 두 모표준편차가 다르다고 하자."
} else {
  assumption = "가정: 두 모집단이 정규분포를 따르고 두 모표준편차가 같다고 하자."
}

lowerbound = (x_bar - y_bar) + qt(0.01, df=min(n_1-1, n_2-1)) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qt(0.99, df=min(n_1-1, n_2-1)) * sqrt(s_1^2/n_1 + s_2^2/n_2)

answer_1 = paste("(", lowerbound, ",", upperbound, ")")

t = ((x_bar - y_bar) - 20) / sqrt(s_1^2/n_1 + s_2^2/n_2)
alpha = 0.025

if (t < qt(p=alpha, df=min(n_1-1, n_2-1))) {
  message = sprintf("유의수준 %.3f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.3f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pt(t, df = min(n_1-1, n_2-1))

answer_2 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message
)

cat(assumption, "\n(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.2.16 정신분석가들은 아동학대와 범죄행위 간의 관련성에 대하여 오랫동안 연구를 해왔다. 유년시절에 학대들 받은 52명의 소년들과 학대 받지 않은 67명의 소년들에 대한 연구에서 그들이 십대에 일으킨 범죄행위의 건수에 관한 자료는 자료와 같다. 학대 받은 집단의 범죄행위의 평균 건수가 더 높다고 할 수 있는가? (P-값을 계산하여 답하라.)

```{r}
data = read.csv("../Data/exercise_12_2_16.csv", row.names = 1)

x_bar = data["mean", "abused"]
y_bar = data["mean", "not_abused"]
s_1 = data["sd", "abused"]
s_2 = data["sd", "not_abused"]
n_1 = 52
n_2 = 67
alpha=0.05
z = ((x_bar - y_bar) - 0) / sqrt(s_1^2/n_1 + s_2^2/n_2)

if (z > qnorm(1-alpha)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pnorm(z)

answer = paste(
  " 검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n", message
)

cat(answer)
```

<br/>

#### 12.2.18 사람이 격렬한 운동을 할 때에 필요한 단위 체중당 산소흡입량(산소흡입력)은 노동능력의 측도가 된다. 페루의 고지대에 살고 있는 20명의 원주민으로 구성된 집단 1과 성인이 되어서 고지대 환경에 적응된 저지대인 10명으로 구성된 집단 2의 산소흡입력 비교를 위해서 두 집단을 측정하였으며 기록된 자료의 통계량 값이 계산되었다. 

##### (1) 두 집단 간 평균 산소흡입력의 차에 대한 98% 신뢰구간을 구하라.

##### (2) 제시된 자료는 고지대의 원주민과 고지대에 적응된 저지대인의 평균 산소흡입력 차이에 대한 증거를 제시하는가?

```{r}
data = read.csv("../Data/exercise_12_2_18.csv", row.names = 1)

x_bar = data["mean", "group_1"]
y_bar = data["mean", "group_2"]
s_1 = data["sd", "group_1"]
s_2 = data["sd", "group_2"]
n_1 = 20
n_2 = 10
s_p = sqrt(((n_1 - 1) * s_1^2 + (n_2 - 1) * s_2^2) / (n_1 + n_2 - 2))

lowerbound = (x_bar - y_bar) + qt(0.01, df=n_1 + n_2 - 2) * s_p * sqrt(1/n_1 + 1/n_2)
upperbound = (x_bar - y_bar) + qt(0.99, df=n_1 + n_2 - 2) * s_p * sqrt(1/n_1 + 1/n_2)

answer_1 = paste("(", lowerbound, ",", upperbound, ")")

t = ((x_bar - y_bar) - 0) / (s_p * sqrt(1/n_1 + 1/n_2))
alpha = 0.05

if ((t < qt(alpha/2, df = n_1 + n_2 - 2)) | (t > qt(1-alpha/2, df = n_1 + n_2 - 2))) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

if (t < 0) {
  p_value = pt(t, df = n_1 + n_2 - 2)
} else {
  p_value = 1 - pt(t, df = n_1 + n_2 - 2)
}

answer_2 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message, "따라서 차이가 존재한다."
)

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.2.20 공장 노동자들이 숙련작업을 수행하기 위해 교육받는 2개의 프로그램을 비교하기 위해 20명의 노동자들이 실험에 임하였다. 그들 중 10명을 임의로 뽑아서 방법1에 의해 교육을 받게 하고 나머지 10명은 방법2에 의해 교육을 받게 하였다. 교육을 끝내고 난 후 모든 노동자들을 대상으로 숙련작업 수행에 필요한 시간을 측정하여 자료를 얻었다. (단위: 분)

##### (1) 이들 자료로부터 방법1의 교육을 받은 후의 평균 작업 시간이 방법 2보다 적다고 할 수 있는가?

##### (2) 모집단에 대한 필요한 가정이 있으면 기술하라.

##### (3) 두 방법 사이에 작업 시간의 모평균 차에 대한 95% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_2_20.csv")

x_bar = mean(data[,"method_1"])
y_bar = mean(data[,"method_2"])
s_1 = sd(data[,"method_1"])
s_2 = sd(data[,"method_2"])
n_1 = length(data[,"method_1"])
n_2 = length(data[,"method_2"])
s_p = sqrt(((n_1 - 1) * s_1^2 + (n_2 - 1) * s_2^2) / (n_1 + n_2 - 2))
alpha = 0.05

t = ((x_bar - y_bar) - 0) / (s_p * sqrt(1/n_1 + 1/n_2))

if (t < qt(alpha, df = n_1 + n_2 - 2)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = pt(t, df = n_1 + n_2 - 2)

answer_1 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message
)

answer_2 = "가정: 두 모집단이 정규분포를 따르고 두 모표준편차가 같다고 하자."

lowerbound = (x_bar - y_bar) + qt(alpha/2, df=n_1+n_2-2) * s_p * sqrt(1/n_1 + 1/n_2)
upperbound = (x_bar - y_bar) + qt(1-alpha/2, df=n_1+n_2-2) * s_p * sqrt(1/n_1 + 1/n_2)

answer_3 = paste("(", lowerbound, ",", upperbound, ")")

cat("(1)", answer_1, "\n(2)", answer_2, "\n(3)", answer_3)
```

<br/>

#### 12.2.22 성장 호르몬 투약이 새끼를 밴 쥐의 체중 증가에 미치는 영향에 대하여 조사를 하였다. 6마리의 정상인 쥐(집단1)와 성장 호르몬을 주입한 6마리 쥐(집단2)에 대하여 체중 증가에 대한 자료와 같은 통계량 값이주어졌다. 모집단에 대한 가정을 기술하고, 호르몬 투약을 한 쥐가 정상인 쥐보다 평균 체중 증가가 크다고 할 수 있는지에 대한 가설을 검정하라.

```{r}
data = read.csv("../Data/exercise_12_2_22.csv", row.names = 1)

assumption = " 가정: 두 모집단이 정규분포를 따르지만 두 모표준편차가 다르다고 하자."
x_bar = data["mean", "group_1"]
y_bar = data["mean", "group_2"]
s_1 = data["sd", "group_1"]
s_2 = data["sd", "group_2"]
n_1 = 6
n_2 = 6
alpha = 0.05

t = ((x_bar - y_bar) - 0) / sqrt(s_1^2/n_1 + s_2^2/n_2)

if (t < qt(alpha, df=min(n_1-1, n_2-1))) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = pt(t, df = min(n_1-1, n_2-1))

answer = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n", message
)

cat(assumption, "\n", answer)
```

<br/>

#### 12.2.24 두 모집단으로부터 서로 독립인 두 개의 표본에 대한 통계량들이 자료와 같이 4번 주어졌다. 각 경우에 모평균의 차에 대한 98% 신뢰구간을 구하고 실험에 필요한 가정을 말하라.

```{r}
data = read.csv("../Data/exercise_12_2_24.csv", row.names = 1)

# 1번 풀이
x_bar = data["(1) mean", "group_1"]
y_bar = data["(1) mean", "group_2"]
s_1 = data["(1) sd", "group_1"]
s_2 = data["(1) sd", "group_2"]
n_1 = data["(1) n", "group_2"]
n_2 = data["(1) n", "group_2"]
s_p = sqrt(((n_1 - 1) * s_1^2 + (n_2 - 1) * s_2^2) / (n_1 + n_2 - 2))
lowerbound = (x_bar - y_bar) + qt(0.01, df=n_1 + n_2 - 2) * s_p * sqrt(1/n_1 + 1/n_2)
upperbound = (x_bar - y_bar) + qt(0.99, df=n_1 + n_2 - 2) * s_p * sqrt(1/n_1 + 1/n_2)
answer_1 = paste("(", lowerbound, ",", upperbound, ")")

# 2번 풀이
x_bar = data["(2) mean", "group_1"]
y_bar = data["(2) mean", "group_2"]
s_1 = data["(2) sd", "group_1"]
s_2 = data["(2) sd", "group_2"]
n_1 = data["(2) n", "group_2"]
n_2 = data["(2) n", "group_2"]
lowerbound = (x_bar - y_bar) + qnorm(0.01) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qnorm(0.99) * sqrt(s_1^2/n_1 + s_2^2/n_2)
answer_2 = paste("(", lowerbound, ",", upperbound, ")")

# 3번 풀이
x_bar = data["(3) mean", "group_1"]
y_bar = data["(3) mean", "group_2"]
s_1 = data["(3) sd", "group_1"]
s_2 = data["(3) sd", "group_2"]
n_1 = data["(3) n", "group_2"]
n_2 = data["(3) n", "group_2"]
lowerbound = (x_bar - y_bar) + qt(0.01, df=min(n_1-1, n_2-1)) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qt(0.99, df=min(n_1-1, n_2-1)) * sqrt(s_1^2/n_1 + s_2^2/n_2)
answer_3 = paste("(", lowerbound, ",", upperbound, ")")

# 4번 풀이
x_bar = data["(4) mean", "group_1"]
y_bar = data["(4) mean", "group_2"]
s_1 = data["(4) sd", "group_1"]
s_2 = data["(4) sd", "group_2"]
n_1 = data["(4) n", "group_2"]
n_2 = data["(4) n", "group_2"]
lowerbound = (x_bar - y_bar) + qnorm(0.01) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qnorm(0.99) * sqrt(s_1^2/n_1 + s_2^2/n_2)
answer_4 = paste("(", lowerbound, ",", upperbound, ")")

cat(
  "(1) 가정: 두 모집단이 정규분포를 따르고 두 모표준편차가 같다고 하자.", 
  "\n   ", answer_1, "\n(2)", answer_2,
  "\n(3) 가정: 두 모집단이 정규분포를 따르지만 두 모표준편차가 다르다고 하자.", 
  "\n   ", answer_3, "\n(4)", answer_4
)

```

<br/>

### 12.3 짝비교 

<br/>

#### 12.3.2 자료와 같이 짝이 이루어져 있다고 하자.

##### (1) 통계량 $t = \frac{\bar{D}}{s_D / \sqrt(n)}$ 의 값을 계산하라.

##### (2) 위의 $t$ 분포의 자유도는 얼마인가?

```{r}
data = read.csv("../Data/exercise_12_3_02.csv")

data$d = data$x - data$y
d_bar = mean(data$d)
s_d = sd(data$d)

answer_1 = d_bar / (s_d / sqrt(length(data$d)))
answer_2 = nrow(data) - 1

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.3.6 어떤 영양학자는 사이크로트롭스(PC)라고 불리는 일종의 박테리아를 넣은 탈지유와 PC를 넣지 않은 탈지유로 만들어진 요구르트 질에 차가 있는지를 연구하고자 한다. 탈지유의 표본을 7곳의 우유 농장에서 채취한 후, 각각 절반의 우유에는 PC를 주입하고 나머지 절반의 우유에는 PC를 주입하지 않았다. 이렇게 얻어진 우유로 요구르트를 만들어 각각 응고된 정도를 측정하여 기록하였더니 결과가 자료와 같았다. (수치가 큰 것이 응고 정도가 강함을 나타낸다고 하자.) 자료로부터 PC가 주입된 우유로 만든 요구르트의 응고 정도가 더 강하다고 결론을 내릴 수 있겠는가? ($\alpha=0.05$로 검정하라.)


```{r}
data = read.csv("../Data/exercise_12_3_06.csv", row.names = 1)

data$d = data$PC_added - data$PC_not_added
d_bar = mean(data$d)
s_d = sd(data$d)
n = length(data$d)
alpha = 0.05

t = d_bar / (s_d / sqrt(n))

if (t > qt(p=1-alpha, df=n-1)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pt(t, df=n-1)

answer = paste(
  " 검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n", message
)

cat(answer)
```

<br/>

#### 12.3.8 통조림 공장에서 통조림을 제조하기 전에 많은 양의 끓는 물로 채소를 세척하고 있다. 그런데 새로 개발된 방법인 증기를 이용한 세척방법(SBP)을 사용하면 채소에 들어 있는 비타민과 미네랄이 기존의 방법보다 적게 손실된다고 한다. 10곳의 농장에서 얻은 10다발의 콩을 가지고 SBP 방법과 기존의 방법을 비교하고자 한다. 각 다발의 콩 중에서 반은 기존의 방법으로, 나머지 반은 SBP 방법으로 처리한 후 통조림 된 콩에서 450g당 비타민의 양을 측정하였다. 두 가지 방법을 사용하였을 때 450g당 비타민 양의 평균차에 대한 98% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_3_08.csv")

data$d = data$SBP - data$not_SBP 
d_bar = mean(data$d)
s_d = sd(data$d)
n = length(data$d)

lowerbound = d_bar + qt(0.01, df=n-1) * s_d / sqrt(n)
upperbound = d_bar + qt(0.99, df=n-1) * s_d / sqrt(n)

answer = paste("(", lowerbound, ",", upperbound, ")")
cat(answer)
```

<br/>

#### 12.3.10 어려운 것을 기억하는 두 가지 방법 중 어떤 것이 더 효과적인지 결정하고자 한다. 자료는 IQ와 성적을 기준으로 짝지은 9쌍의 학생들을 대상으로 두 방법을 각 쌍에서 임의로 배정하여 기억력 실험을 시행한 결과이다. $\alpha=0.05$에서 두 가지 방법의 효과의 차이가 유의한지를 검정하라.

```{r}
data = read.csv("../Data/exercise_12_3_10.csv")

data$d = data$A - data$B
d_bar = mean(data$d)
s_d = sd(data$d)
n = length(data$d)
alpha = 0.05

t = d_bar / (s_d / sqrt(n))

if ((t < qt(alpha/2, df=n-1)) | (t > qt(1-alpha/2, df=n-1))) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

if (t > 0) {
  p_value = 1 - pt(t, df=n-1)
} else {
  p_value = pt(t, df=n-1)
}

answer = paste(
  " 검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n", message
)

cat(answer)
```

<br/>

#### 12.3.11 각각 다른 도에 위치한 8곳의 농장에서 A와 B 두 종류의 우리밀을 같은 면적에서 재배하여 생산량 비교 실험을 하였다. 단위면적당 수확량을 결과는 자료와 같다.

##### (1) 우리밀 A가 우리밀 B보다 더 높은 평균생산량을 갖는다는 강력한 증거가 있는가? 유의수준 $\alpha=0.05$로 검정하라.

##### (2) 이 실험에서 랜덤화를 하기 위해서는 어떻게 하겠는가?

```{r}
data = read.csv("../Data/exercise_12_3_11.csv")

data$d = data$A - data$B
d_bar = mean(data$d)
s_d = sd(data$d)
n = length(data$d)
alpha = 0.05

t = d_bar / (s_d / sqrt(n))

if (t > qt(1-alpha, df=n-1)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pt(t, df=n-1)

answer_1 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message, 
  "\n    따라서 우리밀 A가 우리밀 B보다 더 높은 평균생산량을 갖는다고 볼 수 있다."
)

answer_2 = "이 문제와 같이 자료가 처음부터 짝지워져 있는 경우,\n    두 개의 처리를 어떻게 배정할 것인가는 전혀 문제되지 않는다.\n    따라서 랜덤화가 필요하지 않다."

cat("(1)", answer_1, "\n(2)", answer_2)

```

<br/>

#### 12.3.12 연습문제 **3.11**에서 이번에는 16곳의 농장을 선택해서 8곳에는 우리밀 A를 나머지에는 우리밀 B를 심었다고 한다. 단위면적당 수확량은 자료와 같다.

##### (1) 우리밀 A가 우리밀 B보다 더 높은 평균생산량을 갖는다는 강력한 증거가 있는가? 유의수준 $\alpha=0.05$로 검정하라.

##### (2) 이 실험에서 랜덤화란 무엇이며 랜덤화를 하고자 하면 어떻게 하여야 하겠는가?

##### (3) 이 자료는 연습문제 **3.11**의 자료를 뒤섞어 놓은 형태이다. 두 가지 상황에서 결과가 다른 이유를 설명하라. 

```{r}
data = read.csv("../Data/exercise_12_3_12.csv")

x_bar = mean(data$A)
y_bar = mean(data$B)
s_1 = sd(data$A)
s_2 = sd(data$B)
n_1 = length(data$A)
n_2 = length(data$B)
s_p = sqrt( ((n_1-1) * s_1^2 + (n_2-1) * s_2^2) / (n_1 + n_2 - 2))
alpha = 0.05

t = (x_bar - y_bar) / (s_p * sqrt(1/n_1 + 1/n_2))

if (t > qt(1-alpha, df=n_1 + n_2 - 2)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pt(t, df=n_1 + n_2 - 2)

answer_1 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message, 
  "\n    따라서 우리밀 A가 우리밀 B보다 더 높은 평균생산량을 갖는다고 볼 수 있다."
)

answer_2 = "이 실험에서 랜덤화란, 여러 조건들이 어느 한 쪽의 처리에만 영향을 주지 않고\n    확률적으로 같은 정도로 영향을 미치도록 처리를 무작위로 배정하는 것을 뜻한다.\n    랜덤화를 하고자 하면 각 쌍에서 동전 던지기를 통해 A 또는 B를 심도록 할 수 있다."

answer_3 = "3.11과 3.12의 상황에서 결과가 다른 이유는, 각 쌍 내에서 독립이냐 독립이 아니냐의\n    차이가 있기 때문이다. 3.11의 경우 각 쌍 내에서 독립이 아니지만, 3.21의 경우는\n    각 쌍 내에서 독립이라 볼 수 있다."

cat("(1)", answer_1, "\n(2)", answer_2, "\n(3)", answer_3)
```

<br/>

#### 12.4.2 두 집단 A와 B에서 각각 100명의 여성을 뽑아 "24세가 되기 전에 결혼하셨습니까?"라는 질문을 하였다. 그 결과는 자료와 같이 얻어졌다.

##### (1) 양측검정의 방법으로 두 집단의 24세 이전에 결혼한 비율이 같은지를 검정하라. (유의수준 $\alpha=0.05$)

##### (2) $(p_A - p_B)$에 대한 95% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_4_02.csv", row.names = 1)
p_1 = data["Yes", "A"] / sum(data$A)
p_2 = data["Yes", "B"] / sum(data$B)
n_1 = sum(data$A)
n_2 = sum(data$B)
p_hat = sum(data["Yes",]) / sum(data)
alpha = 0.05

# 1번
z = (p_1 - p_2) / (sqrt(p_hat * (1-p_hat)) * sqrt(1/n_1 + 1/n_2))

if ( (z > qnorm(1-alpha/2)) | (z < qnorm(alpha/2))) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pnorm(z)

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  p_value, "이므로,\n   ", message, 
  "\n    따라서 두 집단의 24세 이전에 결혼한 비율이 다르다고 볼 수 있다."
)

# 2번
lowerbound = (p_1 - p_2) + qnorm(alpha/2) * sqrt(p_1*(1-p_1)/n_1 + p_2*(1-p_2)/n_2)
upperbound = (p_1 - p_2) + qnorm(1-alpha/2) * sqrt(p_1*(1-p_1)/n_1 + p_2*(1-p_2)/n_2)
answer_2 = paste("(", lowerbound, ",", upperbound, ")")

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.4.4 두 가지 새로운 약 A와 약 B를 비교 연구하기 위해, 120명의 환자에게는 약 A를, 150명의 환자에게는 약 B를 복용시킨 후 자료와 같은 결과를 얻었다.

##### (1) 이 결과로부터 약 A보다 약 B가 더 높은 치유율을 갖는다고 설명할 수 있겠는가?

##### (2) 두 약의 치유율의 차에 대한 95% 신뢰구간을 구하라.

##### (3) 각 약의 치유율에 대한 95% 신뢰구간을 각각 구하라.

```{r}
data = read.csv("../Data/exercise_12_4_03.csv", row.names = 1)

p_1 = data["Cured", "A"] / sum(data$A)
p_2 = data["Cured", "B"] / sum(data$B)
n_1 = sum(data$A)
n_2 = sum(data$B)
p_hat = sum(data["Cured", ]) / sum(data)
alpha = 0.05

# 1번
z = (p_1 - p_2) / (sqrt(p_hat * (1 - p_hat)) * sqrt(1/n_1 + 1/n_2))

if (z < qnorm(alpha)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = pnorm(z)

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message, 
  "\n    따라서 약 A보다 약 B가 더 높은 치유율을 갖는다고 설명 할 수 있다."
)

# 2번
lowerbound = (p_1 - p_2) + qnorm(alpha/2) * sqrt(p_1*(1-p_1)/n_1 + p_2*(1-p_2)/n_2)
upperbound = (p_1 - p_2) + qnorm(1-alpha/2) * sqrt(p_1*(1-p_1)/n_1 + p_2*(1-p_2)/n_2)
answer_2 = paste("(", lowerbound, ",", upperbound, ")")

# 3번
lowerbound_1 = p_1 + qnorm(alpha/2) * sqrt(p_1 * (1-p_1) / n_1)
upperbound_1 = p_1 + qnorm(1-alpha/2) * sqrt(p_1 * (1-p_1) / n_1)
lowerbound_2 = p_2 + qnorm(alpha/2) * sqrt(p_2 * (1-p_2) / n_2)
upperbound_2 = p_2 + qnorm(1-alpha/2) * sqrt(p_2 * (1-p_2) / n_2)
answer_3_1 = paste("(", lowerbound_1, ",", upperbound_1, ")")
answer_3_2 = paste("(", lowerbound_2, ",", upperbound_2, ")")

cat("(1)", answer_1, "\n(2)", answer_2, "\n(3)", answer_3_1, "\n   ", answer_3_2)
```

<br/>

#### 12.4.6 높은 반응능력(HRL)을 가진 49명 여자 고등학생과 낮은 반응능력(LRL)을 가진 54명 여자 고등학생을 대상으로 또래 집단으로부터 받게 되는 정신적인 압력에 대한 반응을 조사하였더니 결과가 자료와 같았다.

##### (1) LRL 집단보다 HRL 집단이 정신적인 압력에 대한 저항이 낮다고 할 수 있는가? (P-값을 계산하여 결론을 내려라.)

##### (2) HRL과 LRL 집단의 정신적인 압력에 대한 저항률의 차의 99% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_4_05.csv", row.names = 1)

p_1 = data["resistant", "HRL"] / sum(data$HRL)
p_2 = data["resistant", "LRL"] / sum(data$LRL)
p_hat = sum(data["resistant", ]) / sum(data)
n_1 = sum(data$HRL)
n_2 = sum(data$LRL)
alpha = 0.01

# 1번
z = (p_1 - p_2) / (sqrt(p_hat * (1-p_hat)) * sqrt(1/n_1 + 1/n_2))

if (z < qnorm(alpha)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = pnorm(z)

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  p_value, "이므로,\n   ", message, 
  "\n    LRL 집단보다 HRL 집단이 정신적인 압력에 대한 저항이 낮다고 볼 수 있다."
)

# 2번
lowerbound = (p_1 - p_2) + qnorm(alpha/2) * sqrt(p_1*(1-p_1) / n_1 + p_2*(1-p_2) / n_2)
upperbound = (p_1 - p_2) + qnorm(1-alpha/2) * sqrt(p_1*(1-p_1) / n_1 + p_2*(1-p_2) / n_2)

answer_2 = paste("(", lowerbound, ",", upperbound, ")")

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.4.8 아동학대와 범죄행위 간의 관련성에 대한 연구에서 85명의 소년이 어른들로부터 학대를 받았고 120명의 소년이 받지 않았다고 하자. 학대를 받은 집단의 21명, 받지 않은 집단의 11명이 십대에 고질적인 범죄자가 되었다는 것을 알아내었다. 

##### (1) 이 자료로부터 학대 받은 소년들이 학대 받지 않은 집단보다 고질적 범죄자가 되기 쉽다는 추측을 증명할 수 있겠는가? 유의수준 $\alpha=0.01$로 검정하라.

##### (2) 학대 받은 모집단, 받지 않은 모집단에서 고질적 범죄자가 되는 실제 비율의 차에 대한 95% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_4_07.csv", row.names = 1)

p_1 = data["Criminal", "Abused"] / sum(data$Abused)
p_2 = data["Criminal", "Not_Abused"] / sum(data$Not_Abused)
n_1 = sum(data$Abused)
n_2 = sum(data$Not_Abused)
p_hat = sum(data["Criminal",]) / sum(data)

# 1번
alpha = 0.01
z = (p_1 - p_2) / sqrt((p_hat * (1-p_hat)) * (1/n_1 + 1/n_2))

if (z > qnorm(1-alpha)) {
  message = sprintf(
    "유의수준 %.2f 하에서 귀무가설을 기각한다.\n    따라서 학대 받은 소년들이 학대 받지 않은 집단보다 범죄자가 되기 쉽다고 추측할 수 있다.", 
    alpha
  )
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.\n    따라서 학대 받은 소년들이 학대 받지 않은 집단보다 범죄자가 되기 쉽다는 추측하기 어렵다.", alpha)
}

p_value = 1 - pnorm(z)

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

# 2번
alpha = 0.05
lowerbound = (p_1 - p_2) + qnorm(alpha/2) * sqrt(p_1*(1-p_1) / n_1 + p_2*(1-p_2) / n_2)
upperbound = (p_1 - p_2) + qnorm(1-alpha/2) * sqrt(p_1*(1-p_1) / n_1 + p_2*(1-p_2) / n_2)

answer_2 = paste("(", lowerbound, ",", upperbound, ")")

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.4.10 대중적으로 인기 있는 살균제 리스테린은 영국의 내과의사로서 방부제 사용의 개척자인 조세프 리스터의 이름을 따서 명명한 것이다. 그는 다년간 75명의 절단수술을 하였는데 40명에 대하여 살균제로 리스테린을 사용하고 35명에 대하여 어떤 살균제도 사용하지 않았다. 그 결과는 자료와 같이 얻어졌다.

##### (1) 두 집단 사이에 생존율의 차이가 존재한다고 할 수 있는가? (유의수준 $\alpha=0.05$에서 검정하고 P-값을 계산하라.)

##### (2) 자료로부터 두 집단의 생존율의 차에 대한 95% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_4_09.csv", row.names = 1)

p_1 = data["Alive", "used"] / sum(data$used)
p_2 = data["Alive", "not_used"] / sum(data$not_used)
n_1 = sum(data$used)
n_2 = sum(data$not_used)
p_hat = sum(data["Alive", ]) / sum(data)
alpha = 0.05

# 1번
z = (p_1 - p_2) / sqrt(p_hat * (1-p_hat) * (1/n_1 + 1/n_2))

if ((z > qnorm(1-alpha/2)) | (z <= qnorm(alpha/2))) {
  message = sprintf(
    "유의수준 %.2f 하에서 귀무가설을 기각한다.\n    따라서 두 집단 사이 생존율의 차이가 존재한다고 볼 수 있다.", 
    alpha
  )
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.\n    따라서 두 집단 사이 생존율의 차이가 없다고 볼 수 있다.", alpha)
}

if (z > 0) {
  p_value = 1 - pnorm(z)
} else {
  p_value = pnorm(z)
}

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

# 2번
lowerbound = (p_1 - p_2) + qnorm(alpha/2) * sqrt(p_1*(1-p_1) / n_1 + p_2*(1-p_2) / n_2)
upperbound = (p_1 - p_2) + qnorm(1-alpha/2) * sqrt(p_1*(1-p_1) / n_1 + p_2*(1-p_2) / n_2)

answer_2 = paste("(", lowerbound, ",", upperbound, ")")

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.4.12 30, 40대의 250명과 60, 70대의 250명을 임의추출하여 그들의 하루 수면시간을 조사 정리한 결과의 일부가 자료와 같이 주어졌다.

##### (1) 하루 수면시간이 8시간 이하인 사람들의 비율이 30, 40대가 60, 70대보다 많다는 것이 통계적으로 유의한가? (P-값을 계산하라.)

##### (2) 자료로부터 30, 40대와 60, 70대의 두 모집단에서 하루 수면시간이 8시간 이하인 사람의 모비율을 각각 $p_1$, $p_2$라고 할 때 $(p_1 - p_2)$의 95% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_4_11.csv", row.names = 1)

p_1 = data["<=8", "X30_40"] / sum(data$X30_40)
p_2 = data["<=8", "X60_70"] / sum(data$X60_70)
n_1 = 250
n_2 = 250
p_hat = sum(data["<=8", ]) / (n_1 + n_2) 
alpha = 0.05

# 1번
z = (p_1 - p_2) / sqrt(p_hat * (1 - p_hat) * (1/n_1 + 1/n_2))

if (z > qnorm(1-alpha)) {
  message = sprintf(
    "유의수준 %.2f 하에서 귀무가설을 기각한다.\n    따라서 30, 40대의 비율이 60, 70대보다 많다고 볼 수 있다.", 
    alpha
  )
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.\n    따라서 두 집단 사이 비율의 차이가 없다고 볼 수 있다.", alpha)
}

p_value = 1 - pnorm(z)

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  p_value, "이므로,\n   ", message 
)

# 2번 
lowerbound = (p_1 - p_2) + qnorm(alpha/2) * sqrt(p_1*(1-p_1) / n_1 + p_2*(1-p_2) / n_2)
upperbound = (p_1 - p_2) + qnorm(1-alpha/2) * sqrt(p_1*(1-p_1) / n_1 + p_2*(1-p_2) / n_2)

answer_2 = paste("(", lowerbound, ",", upperbound, ")")

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.4.14 두 모집단으로부터 크기가 $n_1$, $n_2$인 서로 독립인 표본을 추출하였다고 하자. 또한 그 표본의 성공률을 $\hat{p_1} = 0.62$, $\hat{p_2} = 0.51$이라고 하자. 다음의 각 경우에 대해 두 모비율이 통계적으로 차이가 있다고 할 수 있는지를 각각에 주어진 유의수준에 대하여 검정하라.

##### (1) $n_1=42$, $n_2=50$, $\alpha=0.05$

##### (2) $n_1=200$, $n_2=210$, $\alpha=0.05$

##### (3) $n_1=200$, $n_2=210$, $\alpha=0.01$

```{r}
p_1 = 0.62
p_2 = 0.51

# 1번
n_1 = 42
n_2 = 50
p_hat = (n_1 * p_1 + n_2 * p_2) / (n_1 + n_2)
alpha = 0.05

z = (p_1 - p_2) / sqrt(p_hat * (1-p_hat) * (1/n_1 + 1/n_2))

if ((z < qnorm(alpha/2)) | (z > qnorm(1-alpha/2))) {
  message = sprintf(
    "유의수준 %.2f 하에서 귀무가설을 기각한다.\n    따라서 두 모비율이 통계적으로 차이가 있다.", 
    alpha
  )
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.\n    따라서 두 모비율이 통계적으로 차이가 없다.", alpha)
}

if (z > 0) {
  p_value = 1 - pnorm(z)  
} else {
  p_value = pnorm(z)
}

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

# 2번
n_1 = 200
n_2 = 210
p_hat = (n_1 * p_1 + n_2 * p_2) / (n_1 + n_2)
alpha = 0.05

z = (p_1 - p_2) / sqrt(p_hat * (1-p_hat) * (1/n_1 + 1/n_2))

if ((z < qnorm(alpha/2)) | (z > qnorm(1-alpha/2))) {
  message = sprintf(
    "유의수준 %.2f 하에서 귀무가설을 기각한다.\n    따라서 두 모비율이 통계적으로 차이가 있다.", 
    alpha
  )
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.\n    따라서 두 모비율이 통계적으로 차이가 없다.", alpha)
}

if (z > 0) {
  p_value = 1 - pnorm(z)  
} else {
  p_value = pnorm(z)
}

answer_2 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

# 3번
alpha = 0.01

z = (p_1 - p_2) / sqrt(p_hat * (1-p_hat) * (1/n_1 + 1/n_2))

if ((z < qnorm(alpha/2)) | (z > qnorm(1-alpha/2))) {
  message = sprintf(
    "유의수준 %.2f 하에서 귀무가설을 기각한다.\n    따라서 두 모비율이 통계적으로 차이가 있다.", 
    alpha
  )
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.\n    따라서 두 모비율이 통계적으로 차이가 없다.", alpha)
}

if (z > 0) {
  p_value = 1 - pnorm(z)  
} else {
  p_value = pnorm(z)
}

answer_3 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

cat("(1)", answer_1, "\n(2)", answer_2, "\n(3)", answer_3)
```

<br/>

#### 12.4.16 당뇨병, 심장질환, 간질 등의 병을 가지고 있는 운전자들 집단과 질환을 갖지 않은 운전자들 집단에 대한 운전기록이 자료와 같이 주어져 있다. $p_1$, $p_2$, $p_3$, $p_4$를 자료의 네 집단(당뇨병, 심장질환, 간질, 질환 없음)에 대한 1회 이상 교통위반을 한 모비율이라고 하자.

##### (1) 가설 $H_0: p_1 = p_4$ 대 $H_0: p_1 > p_4$에 대하여 유의수준 $\alpha=0.10$로 검정하라.

##### (2) $p_3$가 $p_4$보다 높다는 강력한 증거가 되겠는가? P-값을 계산하여 답하라.

##### (3) $(p_3 - p_2)$에 대한 95% 신뢰구간을 구하라.

##### (4) $(p_2 - p_4)$에 대한 95% 신뢰구간을 구하라.

##### (5) 각 모비율 $p_1$, $p_2$, $p_3$, $p_4$에 대한 95% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_4_16.csv", row.names = 1)

# 1번
p_1 = data["Violations", "Diabetes"] / sum(data$Diabetes)
p_4 = data["Violations", "No_Disease"] / sum(data$No_Disease)
n_1 = sum(data$Diabetes)
n_4 = sum(data$No_Disease)
p_hat = (p_1 * n_1 + p_4 * n_4) / (n_1 + n_4)
alpha = 0.10

z = (p_1 - p_4) / sqrt(p_hat * (1-p_hat) * (1/n_1 + 1/n_4))

if (z > qnorm(1-alpha)) {
  message = sprintf(
    "유의수준 %.2f 하에서 귀무가설을 기각한다.", 
    alpha
  )
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pnorm(z)  

answer_1 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

# 2번
p_3 = data["Violations", "Epilepsy"] / sum(data$Epilepsy)
p_4 = data["Violations", "No_Disease"] / sum(data$No_Disease)
n_3 = sum(data$Diabetes)
n_4 = sum(data$No_Disease)
p_hat = (p_3 * n_3 + p_4 * n_4) / (n_3 + n_4)
alpha = 0.10

z = (p_3 - p_4) / sqrt(p_hat * (1-p_hat) * (1/n_3 + 1/n_4))

if (z > qnorm(1-alpha)) {
  message = sprintf(
    "유의수준 %.2f 하에서 귀무가설을 기각한다.", 
    alpha
  )
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pnorm(z)  

answer_2 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  p_value, "이므로,\n   ", message 
)

# 3번
p_2 = data["Violations", "Heart_Disease"] / sum(data$Heart_Disease)
n_2 = sum(data$Heart_Disease)
lowerbound = (p_3 - p_2) + qnorm(0.025) * sqrt(p_3*(1-p_3)/n_3 + p_2*(1-p_2)/n_2)
upperbound = (p_3 - p_2) + qnorm(0.975) * sqrt(p_3*(1-p_3)/n_3 + p_2*(1-p_2)/n_2)
answer_3 = paste("(", lowerbound, ",", upperbound, ")")

# 4번
lowerbound = (p_2 - p_4) + qnorm(0.025) * sqrt(p_2*(1-p_2)/n_2 + p_4*(1-p_4)/n_4)
upperbound = (p_2 - p_4) + qnorm(0.975) * sqrt(p_2*(1-p_2)/n_2 + p_4*(1-p_4)/n_4)
answer_4 = paste("(", lowerbound, ",", upperbound, ")")

# 5번
lowerbound_1 = p_1 + qnorm(0.025) * sqrt(p_1 * (1-p_1) / n_1)
upperbound_1 = p_1 + qnorm(0.975) * sqrt(p_1 * (1-p_1) / n_1)
lowerbound_2 = p_2 + qnorm(0.025) * sqrt(p_2 * (1-p_2) / n_2)
upperbound_2 = p_2 + qnorm(0.975) * sqrt(p_2 * (1-p_2) / n_2)
lowerbound_3 = p_3 + qnorm(0.025) * sqrt(p_3 * (1-p_3) / n_3)
upperbound_3 = p_3 + qnorm(0.975) * sqrt(p_3 * (1-p_3) / n_3)
lowerbound_4 = p_4 + qnorm(0.025) * sqrt(p_4 * (1-p_4) / n_4)
upperbound_4 = p_4 + qnorm(0.975) * sqrt(p_4 * (1-p_4) / n_4)

answer_5 = paste(
  "(", lowerbound_1, ",", upperbound_1, ")\n",
  "   (", lowerbound_2, ",", upperbound_2, ")\n",
  "   (", lowerbound_3, ",", upperbound_3, ")\n",
  "   (", lowerbound_4, ",", upperbound_4, ")"
)

cat(
  "(1)", answer_1, "\n(2)", answer_2, "\n(3)", answer_3, 
  "\n(4)", answer_4, "\n(5)", answer_5
)
```

<br/>

### 12.5 종합문제 

<br/>

#### 12.5.2 두 모집단으로부터 서로 독립이며 $n_1=28$, $n_2=24$인 표본에 대한 표준편차의 값이 아래와 같다. 두 표본평균의 차가 10이라는 사실로부터 두 모평균이 차이가 있다고 할 수 있는지 유의수준 0.05에서 검정하라.

##### (1) $s_1=21$, $s_2=29$

##### (2) $s_1=11$, $s_2=14$

```{r}
n_1 = 28
n_2 = 24
alpha = 0.05

# 1번
s_1 = 21
s_2 = 29
s_p = sqrt(((n_1-1) * s_1^2 + (n_2-1) * s_2^2) / (n_1+n_2-2))

t = (10 - 0) / (s_p * sqrt(1/n_1 + 1/n_2))

if ((t < qt(alpha/2, df=n_1+n_2-2)) | (t > qt(1-alpha/2, df=n_1+n_2-2))) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

if (t < 0) {
  p_value = pt(t, df=n_1+n_2-2)
} else {
  p_value = 1 - pt(t, df=n_1+n_2-2)
}

answer_1 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

# 2번
s_1 = 11
s_2 = 14
s_p = sqrt(((n_1-1) * s_1^2 + (n_2-1) * s_2^2) / (n_1+n_2-2))

t = (10 - 0) / (s_p * sqrt(1/n_1 + 1/n_2))

if ((t < qt(alpha/2, df=n_1+n_2-2)) | (t > qt(1-alpha/2, df=n_1+n_2-2))) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

if (t < 0) {
  p_value = pt(t, df=n_1+n_2-2)
} else {
  p_value = 1 - pt(t, df=n_1+n_2-2)
}

answer_2 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

cat("(1)", answer_1, "\n(2)", answer_2)
```

<br/>

#### 12.5.4 두 처리방법을 비교하기 위하여 88개의 재료를 사용하였다. 40개의 재료를 임의로 뽑아서 처리1에 나머지 48개의 재료는 처리2에 할당하였다. 그 반응에 대한 평균과 표준편차는 자료와 같다.

##### (1) 두 처리 효과의 차에 대한 95% 신뢰구간을 구하라.

##### (2) 처리 2의 반응평균이 처리 1의 반응평균보다 10보다 클 것을 기대한다.

##### (2-1) 귀무가설과 대립가설을 세워라.

##### (2-2) 검정통계량과 유의수준 0.10에서 기각역을 구하라.

##### (2-3) 유의수준 0.10에서 검정을 실시하고, P-값을 구하라.

```{r}
data = read.csv("../Data/exercise_12_5_03.csv", row.names = 1)

# 1번
x_bar = data["mean", "Treatment_1"]
y_bar = data["mean", "Treatment_2"]
s_1 = data["sd", "Treatment_1"]
s_2 = data["sd", "Treatment_2"]
n_1 = 40
n_2 = 48

lowerbound = (x_bar - y_bar) + qnorm(0.025) * sqrt(s_1^2 / n_1 + s_2^2 / n_2)
upperbound = (x_bar - y_bar) + qnorm(0.975) * sqrt(s_1^2 / n_1 + s_2^2 / n_2)
answer_1 = paste("(", lowerbound, ",", upperbound, ")")

# 2번
answer_2_1 = "H_0: mu_1 - mu_2 = - 10 vs H_1: mu_1 - mu_2 < - 10"
answer_2_2 = "z = ((x_bar - y_bar) + 10) / sqrt(s_1^2/n_1 + s_2^2/n_2) < qnorm(0.1)"

alpha = 0.1
z = ((x_bar - y_bar) + 10) / sqrt(s_1^2/n_1 + s_2^2/n_2)
if (z < qnorm(0.1)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}
p_value = pnorm(z)

answer_2_3 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

cat("(1)", answer_1, "\n(2-1)", answer_2_1, "\n(2-2)", answer_2_2, "\n(2-3)", answer_2_3)
```

<br/>

#### 12.5.6 약품 A가 약품 B보다 수술 후 통증 경감의 시간이 더 오래 지속되는지를 알아보기 위한 연구가 있었다. 약품 A를 투여한 55명 환자와 약품 B를 투여한 58명 환자의 통증 경감의 시간을 기록하였고 자료와 같은 통계량이 주어졌다.

##### (1-1) 가설 $H_0$와 $H_1$을 세워라.

##### (1-2) 통계량을 구하고 유의수준 0.10에서 기각역을 구하라.

##### (1-3) 유의수준 0.10에서 가설검정한 결과를 말하라. 그리고 P-값을 구하라.

##### (2-1) $(\mu_A - \mu_B)$에 대한 90% 신뢰구간을 구하라.

##### (2-2) 약품 A의 자료만을 이용하여 평균 $\mu_A$에 대한 95% 신뢰구간을 구하라.

```{r}
data = read.csv("../Data/exercise_12_5_05.csv", row.names = 1)

# 1번
answer_1_1 = "H_0: mu_1 = mu_2 vs H_1: mu_1 > mu_2"
answer_1_2 = "z = (x_bar - y_bar) / sqrt(s_1^2 / n_1 + s_2^2 / n_2) > qnorm(0.1)"

x_bar = data$A[1]
y_bar = data$B[1]
s_1 = data$A[2]
s_2 = data$B[2]
n_1 =55
n_2 =58
alpha = 0.1 
z = (x_bar - y_bar) / sqrt(s_1^2 / n_1 + s_2^2 / n_2)

if (z > qnorm(0.1)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}
p_value = 1-pnorm(z)

answer_1_3 = paste(
  "검정통계량 z가", round(z, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n   ", message 
)

# 2번
lowerbound = (x_bar - y_bar) + qnorm(0.05) * sqrt(s_1^2/n_1 + s_2^2/n_2)
upperbound = (x_bar - y_bar) + qnorm(0.95) * sqrt(s_1^2/n_1 + s_2^2/n_2)
answer_2_1 = paste("(", lowerbound, ",", upperbound, ")")

lowerbound = (x_bar) + qnorm(0.025) * s_1 / sqrt(n_1)
upperbound = (x_bar) + qnorm(0.975) * s_1 / sqrt(n_1)
answer_2_2 = paste("(", lowerbound, ",", upperbound, ")")

cat(
  "(1)", answer_1_1, "\n(1-2)", answer_1_2, "\n(1-3)", answer_1_3, 
  "\n(2-1)", answer_2_1, "\n(2-2)", answer_2_2
)
```

<br/>

#### 12.5.8 한 조립공장에 적용 가능한 두 개의 실험계획을 실시하였다. 실험계획 1에 10명의 근로자, 실험계획 2에 12명의 근로자가 작업한 후 조립시간을 기록하였다. 조립시간에 대한 평균과 표준편차는 자료와 같다. 실험계획 2에서의 조립시간이 실험계획 1에서보다 많이 소요된다고 할 수 있는지 유의수준 5%로 검정하라.

```{r}
data = read.csv("../Data/exercise_12_5_08.csv", row.names = 1)
x_bar = data$A[1]
y_bar = data$B[1]
s_1 = data$A[2]
s_2 = data$B[2]
n_1 = 10
n_2 = 12
s_p = sqrt(((n_1-1) * s_1^2 + (n_2-1) * s_2^2) / (n_1 + n_2 - 2))
alpha = 0.05

t = (x_bar - y_bar) / (s_p * sqrt(1/n_1 + 1/n_2))

if (t < qt(alpha, df=n_1+n_2-2)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = pt(t, df = n_1 + n_2 - 2)

answer = paste(
  " 검정통계량 t가", round(t, 4), "이고, p-value가", 
  round(p_value, 4), "이므로,\n", message, 
  "\n 따라서 실험계획 2에서의 조립시간이 실험계획 1에서보다 많이 소요된다고 할 수 없다."
)
cat(answer)
```

<br/>

#### 12.5.10 두 모집단으로부터 서로 독립인 표본에 대한 통계량은 자료와 같다.

##### (1) $(\mu_1 - \mu_2)$에 대한 95% 신뢰구간을 구하라.

##### (2) 모집단의 분포에 대한 가정을 기술하라.

```{r}
data = read.csv("../Data/exercise_12_5_10.csv", row.names = 1)
x_bar = data$sample_1[2]
y_bar = data$sample_2[2]
v_1 = data$sample_1[3]
v_2 = data$sample_2[3]
n_1 = data$sample_1[1]
n_2 = data$sample_2[1]
s_p = sqrt(((n_1-1) * v_1 + (n_2-1) * v_2) / (n_1 + n_2 - 2))
alpha = 0.05

# 1번
lowerbound = (x_bar - y_bar) + qt(alpha/2, df=n_1+n_2-2) * s_p * sqrt(1/n_1+1/n_2)
upperbound = (x_bar - y_bar) + qt(1-alpha/2, df=n_1+n_2-2) * s_p * sqrt(1/n_1+1/n_2)
answer_1 = paste("(", lowerbound, ",", upperbound, ")")

# 2번
answer_2 = paste(
  "1. 두 모집단이 모두 정규분포를 따른다.\n",
  "   2. 두 모집단의 표준편차가 일치한다."
)

cat("(1)", answer_1, "\n(2)", answer_2)  # 8번과 10번이 답안과 숫자가 안 맞는데 다시 확인해보자.
```

<br/>

#### 12.5.12 한 과일 재배자는 새로운 살충제가 곤충으로 인한 손해를 줄일 수 있다는 주장을 확인하고자 한다. 따라서 과일 재배자는 그의 과수원에서 나무 27그루를 이용하여 실험을 하였는데, 나무 12그루에는 새로운 살충제로 처리하고 15그루에는 기존의 살충제로 처리하였다. 그 결과 과일 생산량의 자료가 자료와 같이 얻어졌다고 하자. 이들 자료는 새로운 살충제로 사용하는 것이 더 많은 산출량을 보이고 있음을 증명하는가? 필요한 가정에 대해 언급하고 유의수준 0.05에서 검정을 실시하라.

```{r}
data = read.csv("../Data/exercise_12_5_12.csv", row.names = 1)
x_bar = data$new[1]
y_bar = data$prev[1]
s_1 = data$new[2]
s_2 = data$prev[2]
n_1 = 12
n_2 = 15
s_p = sqrt(((n_1-1) * s_1^2 + (n_2-1) * s_2^2) / (n_1 + n_2 - 2))
alpha = 0.05

t = (x_bar - y_bar) / (s_p * sqrt(1/n_1 + 1/n_2))

if (t > qt(1-alpha, df= n_1 + n_2 - 2)) {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각한다.", alpha)
} else {
  message = sprintf("유의수준 %.2f 하에서 귀무가설을 기각할 수 없다.", alpha)
}

p_value = 1 - pt(t, df = n_1 + n_2 - 2)

answer_1 = paste(
  "1. 두 모집단이 모두 정규분포를 따른다.\n",
  "   2. 두 모집단의 표준편차가 일치한다."
)

answer_2 = paste(
  "검정통계량 t가", round(t, 4), "이고, p-value가", 
  p_value, 4, "이므로,\n   ", message
)

cat("(1)", answer_1, "\n(2)", answer_2)
```












